# configuration file for building snapshots and releases with jitpack.io
#jdk:
#  - openjdk17
#before_install:
#  - ./scripts/prepareJitpackEnvironment.sh
#install:
#  - FILE="-Dfile=android_generated-release.aar"
#  - mvn install:install-file $FILE -DgroupId=com.github.sak-coder -DartifactId=myphsar_module -Dversion=1.0 -Dpackaging=aar -DgeneratePom=true
jdk:
  - openjdk17
before_install:
  - |
    # Install Flutter
    FLUTTER_VERSION="3.13.0"
    if [ ! -d "/tmp/flutter-$FLUTTER_VERSION" ]; then
      echo "Installing Flutter SDK..."
      wget -q https://storage.googleapis.com/flutter_infra_release/releases/stable/linux/flutter_linux_${FLUTTER_VERSION}-stable.tar.xz -O /tmp/flutter.tar.xz
      mkdir -p /tmp/flutter-$FLUTTER_VERSION
      tar -xf /tmp/flutter.tar.xz -C /tmp/flutter-$FLUTTER_VERSION --strip-components=1
      export PATH="$PATH:/tmp/flutter-$FLUTTER_VERSION/bin"
      flutter doctor -v
      flutter pub get
    else
      echo "Flutter SDK already installed"
      export PATH="$PATH:/tmp/flutter-$FLUTTER_VERSION/bin"
    fi
  - cd $HOME
  - export FLUTTER_HOME="/tmp/flutter-$FLUTTER_VERSION"
  - export PATH="$FLUTTER_HOME/bin:$PATH"
install:
  - cd $project_dir
  - flutter pub get
  - cd android
  - ./gradlew clean build
  - ./gradlew assembleRelease
  - ./gradlew publishToMavenLocal
#before_install:
#  - sdk install flutter
#  - sdk use flutter
#  - flutter pub get
#  - cd android
#install:
#  - ./gradlew build
#  - ./gradlew publishToMavenLocal